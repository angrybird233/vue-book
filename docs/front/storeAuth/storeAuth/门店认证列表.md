# 门店认证列表

开发者：冯俊杰

## 接口地址

`/store-auth/v1/front/list`

## 请求方式

`POST`

## 请求参数

| 字段 | 类型   | 必填 | 描述     |
| ---- | ------ | ---- | -------- |
| keyword   | string    | 否   | 门店名称或者编码   |
| auth_status   | int    | 否   | 经销商审核状态：1待经销商认证、2审核通过、3经销商审核驳回,4待营业执照审核,5营业执照审核驳回   |
| order_by   | int    | 是   | 排序类型：1按时间排序、2按距离最近排序   |
| longitude   | float    | 否   | 经度（按距离最近排序时必填）   |
| latitude   | float    | 否   | 维度（按距离最近排序时必填）   |
| page   | int    | 否   | 页码   |
| page_size   | int    | 否   | 条数   |

## 成功响应

| 字段       | 类型    | 描述        |
| ---------- | ------- | ----------- |
| status    | string  | 状态    |
| httpCode     | int  | http状态码    |
| statusCode | int  | 状态码 |
| requestId | string  | 请求ID |
| data  | array  | 返回数据      |

## 失败响应

| 字段       | 类型    | 描述        |
| ---------- | ------- | ----------- |
| status    | string  | 状态    |
| httpCode     | int  | http状态码    |
| statusCode | int  | 状态码 -999：没有门店列表权限 |
| requestId | string  | 请求ID |
| message  | string  | 错误信息      |

### data参数

| 字段 | 类型 | 描述 |
| --- | --- | --- |
| list | array | 数据列表 |
| meta | array | 分页信息 |

#### list参数

| 字段 | 类型 | 描述 |
| --- | --- | --- |
| store_code | string | 门店编码 |
| store_name | string | 门店名称 |
| submit_name | string | 认证提交人 |
| submit_mobile | string | 认证提交人手机号 |
| dealer_status | int | 经销商审核状态：1待审核、2通过、3驳回 |
| customer_status | string | 客服审核状态：1待审核、2通过、3驳回 |
| store_address | string | 门店地址 |
| apply_time | string | 申请时间 |
| door_photo_url | string | 门头照 |
| reject_reason | string | 审核驳回原因 |
| auth_status | string |经销商审核状态：1待经销商认证、2审核通过、3经销商审核驳回,4待营业执照审核,5营业执照审核驳回   |


### meta参数

| 字段 | 类型 | 描述 |
| --- | --- | --- |
| current_page | int | 当前页码 |
| last_page | int | 总页数 |
| page_size | int | 每页条数 |
| total | int | 总条数 |

## 返回结果预览

```json
{
    "status": "success",
    "httpCode": 200,
    "statusCode": 0,
    "data": {
        "list": [
            {
                "store_code": "1234",
                "store_name": "测试门店",
                "submit_name": "施斌",
                "submit_mobile": "18749606043",
                "dealer_status": 2,
                "store_address": "陕西省-西安市-雁塔区-电子城街道哈哈大厦A座705",
                "apply_time": "2021/02/27 10:31:29",
                "door_photo_url": ""
            }
        ],
        "meta": {
            "current_page": 1,
            "last_page": 1,
            "page_size": 10,
            "total": 1
        }
    }
}
```
## 备注：距离最近排序距离算法
### 算法一 （半正矢公式计算两点距离）

```sql
ROUND(
        6378.137 * 2 * ASIN(
            SQRT(
                POW(
                    SIN(
                        (
                            {$longitude} * PI() / 180 - `longitude` * PI() / 180
                        ) / 2
                    ),
                    2
                ) + COS({$longitude} * PI() / 180) * COS(`longitude` * PI() / 180) * 
                POW(
                    SIN(
                        (
                            {$latitude} * PI() / 180 - `latitude` * PI() / 180
                        ) / 2
                    ),
                    2
                )
            )
        ) * 1000
    )
```
### 算法二 （美团优化方案：简化距离计算公式方法，当前使用）缺点：260多千米，两个方法差别17m ，优点：100w数据查询只需11ms原来的需要144ms
```sql
ROUND(
        SQRT(
            POW(
                ({$longitude} - `longitude`) * PI() / 180 
                * 6378137.0 
                * COS(({$latitude}+`latitude`) / 2.0 * PI() / 180)
            , 2)
            +
            POW(
                ({$latitude} - `latitude`) * PI() / 180 
                * 6378137.0
            , 2)
        )
    )
```



